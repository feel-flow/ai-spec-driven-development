# /create-issue — 仕様バリデーション付き Issue 作成支援

Issue を作成する際に、仕様の粒度チェックとタスク種別に応じた参照文書の自動提案を行います。

## 前提

- プロジェクトに `docs/` または `docs-template/` 配下のコア7文書が存在すること
- GitHub リポジトリが設定されていること

## 手順

### 1. タスク種別の確認

ユーザーに Issue の種別を確認してください（AskUserQuestion を使用）:

- **新機能**: 新しい機能の追加
- **バグ修正**: 既存機能の不具合修正
- **リファクタリング**: コード構造の改善
- **インフラ**: CI/CD・デプロイ・インフラ変更
- **ドキュメント**: ドキュメントの追加・修正

### 2. 参照文書の自動提案

タスク種別に応じて、事前に読むべき文書を提案します:

| タスク種別 | 必須参照 | 推奨参照 |
| ------------ | -------- | -------- |
| 新機能 | MASTER, ARCHITECTURE, DOMAIN | PATTERNS, TESTING |
| バグ修正 | 関連 Issue, PATTERNS | TESTING |
| リファクタリング | ARCHITECTURE, PATTERNS | TESTING |
| インフラ | MASTER, DEPLOYMENT | ARCHITECTURE |
| ドキュメント | MASTER | 更新対象文書 |

提案例: 「新機能の Issue を作成します。事前に MASTER.md、ARCHITECTURE.md、DOMAIN.md を確認することを推奨します。」

### 3. Issue 内容のヒアリング

以下の情報をユーザーから収集してください:

- **タイトル**: 簡潔で具体的な Issue タイトル
- **概要**: 何を実現するか
- **目的**: なぜ必要か
- **受け入れ基準**: 完了条件（具体的・検証可能な形で）

### 4. 受け入れ基準の粒度チェック

収集した受け入れ基準が以下の条件を満たしているか検証します:

- [ ] **具体的か**: 「〜が動くこと」ではなく「〜の場合に〜が返ること」のように具体的
- [ ] **検証可能か**: テストで確認できる表現になっている
- [ ] **単一責務か**: 1つの Issue に複数の独立した機能が混在していない
- [ ] **曖昧な表現がないか**: 「適切に」「正しく」「きちんと」等の曖昧語を排除

粒度が不十分な場合、改善提案を出してください:

```
⚠️ 受け入れ基準の粒度チェック

以下の基準が曖昧です:
- 「正しくバリデーションされること」
  → 改善案: 「メールアドレスが RFC 5322 に準拠していない場合、422 エラーを返すこと」

- 「適切にエラーハンドリングすること」
  → 改善案: 「DB接続エラー時に503ステータスとリトライ可能なレスポンスを返すこと」
```

### 5. Issue の作成

検証をパスした内容で Issue を作成します。以下の構造を使用してください:

```markdown
## 概要

[何を実現するか]

## 目的

[なぜ必要か]

## 参照文書

- [タスク種別に応じた参照文書リスト]

## 受け入れ条件

- [ ] [具体的・検証可能な条件1]
- [ ] [具体的・検証可能な条件2]
- [ ] markdownlint エラーなし（該当する場合）
```

### 6. 完了報告

作成した Issue の URL を表示し、次のアクションを提案してください。

## 重要ルール

- 受け入れ基準が曖昧な場合は Issue を作成せず、改善を求めること
- 1 Issue = 1つの成果物を原則とし、スコープが大きい場合は分割を提案すること
- 参照文書が存在しない場合は、その旨を警告すること
- ユーザーの意図を推測で補完せず、不明点は確認すること
