# /assess-impact — 変更影響度評価

変更対象の文書・コードを分析し、影響度を LOW / MEDIUM / HIGH で評価します。HIGH の場合は ADR 作成を促します。

## 前提

- 変更対象のファイルまたは変更内容が明確であること
- プロジェクトに `docs/` または `docs-template/` 配下のコア7文書が存在すること

## 手順

### 1. 変更対象の特定

以下のいずれかの方法で変更対象を特定します:

- **ファイル指定**: ユーザーが変更対象ファイルを指定
- **git diff**: 現在の未コミット変更から自動検出
- **Issue 参照**: Issue 番号から変更予定を推定

### 2. 影響度の評価

以下の基準で影響度を判定します:

| 影響度 | 基準 | 例 |
| -------- | ---- | -- |
| **LOW** | 単一ファイル・単一文書の軽微な変更 | typo修正、コメント追加、テスト追加 |
| **MEDIUM** | 複数ファイルに影響するが後方互換性あり | 新規関数追加、既存APIにオプショナルパラメータ追加 |
| **HIGH** | 後方互換性のない変更、アーキテクチャ変更 | DB スキーマ変更、認証方式変更、API破壊的変更 |

### 3. 影響を受ける文書のリストアップ

変更内容に基づいて、更新が必要な文書を特定します:

- **MASTER.md**: プロジェクト全体の構成が変わる場合
- **ARCHITECTURE.md**: システム構成・技術選定が変わる場合
- **DOMAIN.md**: ビジネスルール・エンティティが変わる場合
- **PATTERNS.md**: 実装パターン・規約が変わる場合
- **TESTING.md**: テスト戦略が変わる場合
- **DEPLOYMENT.md**: デプロイ・運用手順が変わる場合
- **DECISIONS.md**: 技術的判断が含まれる場合

### 4. 結果の出力

以下の形式で結果を出力してください:

```markdown
## 変更影響度評価

### 変更概要
[変更内容の簡潔な説明]

### 影響度: [LOW / MEDIUM / HIGH]

### 判定理由
- [理由1]
- [理由2]

### 影響を受ける文書
| 文書 | 影響内容 | 更新必須？ |
| ---- | -------- | ---------- |
| ARCHITECTURE.md | [具体的な影響] | はい/いいえ |
| PATTERNS.md | [具体的な影響] | はい/いいえ |

### 推奨アクション
1. [アクション1]
2. [アクション2]
```

### 5. HIGH 判定時の追加アクション

影響度が HIGH の場合、以下を追加で実施してください:

- **ADR 作成の提案**: DECISIONS.md に新しい ADR を追加することを強く推奨
- **移行計画の要求**: Phase 1/2/3 の段階的移行計画を策定するよう促す
- **ロールバック計画**: ロールバックのトリガー条件と手順の策定を促す
- **レビュー範囲の拡大**: 影響を受けるすべての文書のレビューを推奨

```
🚨 HIGH 影響度 — 追加アクションが必要です

1. ADR を作成してください（DECISIONS.md のテンプレートを使用）
2. 移行計画を策定してください（Phase 1→2→3）
3. ロールバック計画を策定してください
4. 影響を受ける文書のレビューを実施してください
```

## 重要ルール

- 影響度の判定は保守的に行うこと（迷ったら HIGH 寄りに判定）
- 影響を受ける文書は漏れなくリストアップすること
- HIGH 判定時は ADR 作成を必ず促すこと
- 変更内容が不明確な場合は、ユーザーに確認を求めること
