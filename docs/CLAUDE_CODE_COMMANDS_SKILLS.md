---
id: claude-code-commands-skills
title: Claude Code Commands vs Skills — コンテキスト管理の最適化戦略
version: 1.0.0
status: active
created: 2026-02-08
updated: 2026-02-08
owner: feel-flow
phase: mvp
tags: [claude-code, commands, skills, subagent, context-management]
references:
  - docs/AI_CONFIG_BEST_PRACTICES.md
  - docs/PRACTICAL_GUIDE.md
  - docs-template/SETUP_CLAUDE_CODE.md
changeImpact: medium
---

# Claude Code Commands vs Skills — コンテキスト管理の最適化戦略

> **関連文書**:
>
> - [AIツール設定ベストプラクティス](AI_CONFIG_BEST_PRACTICES.md) - 設定ファイルの書き方
> - [実践ガイド](PRACTICAL_GUIDE.md) - AI Spec Driven Development の全体ガイド
> - [Claude Code セットアップ](../docs-template/SETUP_CLAUDE_CODE.md) - CLAUDE.md テンプレート

## はじめに

Claude Code には 2 種類の拡張機能がある。**コマンド**と**スキル**である。

この 2 つは機能的に似ているが、根本的な違いは **コンテキスト戦略** にある。コマンドはメインセッション内で動作し、スキルは独立したサブエージェントとして隔離実行される。この違いは、特にコードレビューのような大量ファイルを読み込む処理で決定的な差を生む。

> **重要な洞察**: コードレビューのような重い処理は、サブエージェントとして動かさないと、コンテキスト量の観点で効果が出にくい。

---

## 1. コマンドとスキルのアーキテクチャ

### 1.1 コマンド（Commands）

`.claude/commands/*.md` に配置するプロンプトテンプレート。ユーザーが `/コマンド名` で明示的に呼び出す。

| 特性 | 説明 |
| --- | --- |
| 実行場所 | メインセッション内（同じ会話） |
| コンテキスト | メインセッションと共有 |
| トークン消費 | メインセッションの枠を消費する |
| 起動方法 | ユーザーが `/コマンド名` で明示的に実行 |
| 応答速度 | 高速（サブプロセス起動なし） |
| 適用範囲 | 軽量な操作（設定変更、簡易チェック、ファイル作成） |

### 1.2 スキル（Skills / Subagents）

独立したサブエージェントとして実行されるタスク。プラグインとして定義するか、AI が自動判断で起動する。

| 特性 | 説明 |
| --- | --- |
| 実行場所 | 分離されたサブエージェント（別プロセス） |
| コンテキスト | メインセッションとは独立 |
| トークン消費 | メインセッションの枠を消費しない |
| 起動方法 | AI が自動判断 or ユーザーが指示 |
| 応答速度 | やや遅い（サブプロセス起動のオーバーヘッド） |
| 適用範囲 | 重い処理（コードレビュー、全コードベーススキャン、並列分析） |

### 1.3 実行モデルの違い

```text
┌── メインセッション ─────────────────────────────┐
│                                                    │
│  /validate-docs  → 同じコンテキスト内で実行        │
│  /create-issue   → 同じコンテキスト内で実行        │
│  /assess-impact  → 同じコンテキスト内で実行        │
│                                                    │
│  ※ 読み込んだファイルの内容がすべてコンテキストに  │
│    蓄積され、セッションのトークン枠を消費する      │
│                                                    │
│  Task(code-reviewer)                               │
│    └→ 別プロセスで起動（コンテキスト隔離）         │
│       └→ 結果のサマリーだけメインに返却            │
│                                                    │
│  Task(security-reviewer)                           │
│    └→ 別プロセスで起動（コンテキスト隔離）         │
│       └→ 結果のサマリーだけメインに返却            │
│                                                    │
│  ※ サブエージェントが読み込んだファイルは          │
│    メインセッションのトークン枠に影響しない        │
└────────────────────────────────────────────────────┘
```

---

## 2. コンテキスト管理 — なぜ使い分けが重要か

### 2.1 問題: コマンドで重い処理を実行した場合

Claude Code は 200K+ トークンのコンテキストウィンドウを持つが、有限である。

```text
シナリオ: PRレビューを「コマンド」で実行

1. ユーザー: 「このPRをレビューして」（50ファイル、5000行）
2. Claude（メインセッション）:
   - 50ファイル読み込み → 約150K tokens 消費
   - レビュー生成       → 約160K tokens 消費
3. ユーザー: 「テストの書き方は？」
   → コンテキストの80%が消費済み
   → 回答の質が低下、または圧縮が発生
```

### 2.2 解決: スキル（サブエージェント）で処理した場合

```text
シナリオ: PRレビューを「スキル」で実行

1. ユーザー: 「このPRをレビューして」（50ファイル、5000行）
2. Claude（メインセッション）:
   - code-reviewer スキルを起動（別コンテキスト）
   - スキル内で50ファイル読み込み・解析
   - レビュー結果（約5K tokens）のみメインに返却
3. ユーザー: 「テストの書き方は？」
   → メインセッションのコンテキストは十分余裕あり
   → 高品質な回答が可能
```

### 2.3 トークン消費の目安

| 処理内容 | ファイル数 | 推定消費 | コマンド時 | スキル時 |
| --- | --- | --- | --- | --- |
| 文書バリデーション | 7 | 15K tokens | メイン 15K | - |
| 設定ファイル生成 | 3 | 5K tokens | メイン 5K | - |
| PRレビュー（小規模） | 10 | 30K tokens | メイン 30K | メイン 3K |
| PRレビュー（中規模） | 30 | 90K tokens | メイン 90K | メイン 5K |
| PRレビュー（大規模） | 50+ | 150K tokens | メイン 150K | メイン 5K |
| マルチエージェントレビュー | 50+ × 3 | 450K tokens | 不可能 | メイン 15K |

> **ポイント**: スキルでは、サブエージェントが消費するトークンはメインセッションに影響しない。メインに返却されるのはサマリーのみ。

---

## 3. 使い分けの判断基準

### 3.1 コマンドを使うべき場合

| 条件 | 理由 |
| --- | --- |
| 読み込むファイルが 3 つ以下 | コンテキスト消費が少ない |
| 処理時間が 10 秒以内 | 即座のフィードバックが必要 |
| メインセッションの会話履歴が必要 | 直前の対話内容を参照する |
| ファイル作成・設定変更が主目的 | 状態変更は同一コンテキストが自然 |

### 3.2 スキルを使うべき場合

| 条件 | 理由 |
| --- | --- |
| 読み込むファイルが 10 以上 | コンテキスト消費が大きい |
| 処理時間が 30 秒以上 | 重い解析処理 |
| 全コードベーススキャンが必要 | 網羅的分析 |
| 専門的な分析が必要 | セキュリティ、パフォーマンス等 |
| 並列実行が有効 | 複数観点で同時レビュー |

### 3.3 判断フローチャート

```text
作業の実行方法を決定するフロー:

Q1. 読み込むファイル数は？
    ├─ 3以下     → コマンド ✅
    ├─ 4〜9      → Q2 へ
    └─ 10以上    → スキル ✅

Q2. 処理時間の見込みは？
    ├─ 10秒以内  → コマンド ✅
    ├─ 10〜30秒  → Q3 へ
    └─ 30秒以上  → スキル ✅

Q3. メインセッションの会話履歴が必要か？
    ├─ はい      → コマンド ✅
    └─ いいえ    → スキル ✅
```

---

## 4. このプロジェクトの実践例

### 4.1 現状: 6 コマンドの評価

現在の `.claude/commands/` には 6 つのコマンドが存在する。すべてコマンドとして実装している理由を評価する。

| コマンド | 読み込み | 時間 | 会話履歴 | 判定 |
| --- | --- | --- | --- | --- |
| `/init-docs` | テンプレート 7 ファイル | 約 5 秒 | 必要（ユーザー情報） | コマンド適切 |
| `/validate-docs` | 対象 7 ファイル | 約 5 秒 | 不要 | コマンド適切 |
| `/setup-ai-config` | テンプレート 3 ファイル | 約 5 秒 | 必要（ユーザー選択） | コマンド適切 |
| `/create-issue` | MASTER + 関連 2〜3 | 約 5 秒 | 必要（ヒアリング） | コマンド適切 |
| `/assess-impact` | 変更差分 + 関連文書 | 5〜30 秒 | 必要（対話的評価） | コマンド適切 |
| `/pre-commit-check` | 変更差分のみ | 約 10 秒 | 不要 | コマンド適切 |

**結論**: このリポジトリはテンプレートリポジトリであり、実コードが少なく軽量操作が中心のため、現状は全コマンドで適切。

### 4.2 スキルが有効なシナリオ

実際のプロダクト開発プロジェクトや、コードベースが大きいリポジトリでは以下のケースでスキルが有効になる。

#### シナリオ 1: PR コードレビュー

| アプローチ | ファイル数 | メイン消費 | 推奨 |
| --- | --- | --- | --- |
| `/review-pr`（コマンド） | 30 ファイル | 90K tokens | 非推奨 |
| `code-reviewer`（スキル） | 30 ファイル | 5K tokens | 推奨 |

#### シナリオ 2: マルチエージェントレビュー

3 つの専門レビュワー（security / performance / architecture）を並列起動する場合:

| アプローチ | 実行方式 | メイン消費 | 推奨 |
| --- | --- | --- | --- |
| コマンドで順次実行 | 1 人目 → 2 人目 → 3 人目 | 270K+ tokens | 不可能 |
| スキルで並列実行 | 3 人同時・独立コンテキスト | 15K tokens | 推奨 |

#### シナリオ 3: セキュリティ監査

全コードベースを対象としたセキュリティスキャン:

| アプローチ | 範囲 | メイン消費 | 推奨 |
| --- | --- | --- | --- |
| コマンド | 全ファイル | 150K+ tokens | 非推奨 |
| スキル | 全ファイル | 5K tokens | 推奨 |

---

## 5. ベストプラクティス

### 5.1 コマンド設計の原則

| 原則 | 説明 |
| --- | --- |
| 軽量に保つ | 読み込みファイル 3 以下、処理 10 秒以内 |
| 単一責任 | 1 つのコマンドは 1 つの明確なタスクを完了する |
| 対話的に活用 | ユーザーとの対話（AskUserQuestion）を積極活用 |
| 即座のフィードバック | 結果をその場で会話に出力する |

### 5.2 スキル設計の原則

| 原則 | 説明 |
| --- | --- |
| 自己完結させる | 必要な情報をすべてスキル内で収集・処理する |
| サマリーを返す | メインに返却する情報は最小限のサマリーにする |
| 専門性を持たせる | 1 つのスキルは 1 つの専門領域に特化する |
| 並列実行を想定 | 他のスキルとの独立性を確保する |

### 5.3 避けるべきアンチパターン

| アンチパターン | 問題 | 対策 |
| --- | --- | --- |
| コマンドで大量ファイル読み込み | コンテキスト枯渇 | スキルに切り替え |
| スキルで軽量処理 | 起動オーバーヘッドが無駄 | コマンドで十分 |
| スキル結果を全文返却 | コンテキスト節約効果が消失 | サマリーのみ返却 |
| 消費トークンの見積もりなし | 予期しないコンテキスト枯渇 | 事前にファイル数を確認 |

---

## 6. コマンドからスキルへの移行判断

プロジェクトの成長に伴い、既存コマンドをスキルに移行すべきか判断する基準:

| チェック項目 | Yes ならスキル化を検討 |
| --- | --- |
| 読み込みファイルが 10 以上に増えた | コンテキスト消費が大きい |
| 処理時間が 30 秒を超えるようになった | ユーザー待機時間が長い |
| 「コンテキスト不足」の報告が出た | コンテキスト枯渇の兆候 |
| 専門的な分析機能を追加したい | 独立した専門知識が必要 |
| 並列実行で効率化したい | 複数観点の同時処理 |

---

## 参考資料

- [AIツール設定ベストプラクティス](AI_CONFIG_BEST_PRACTICES.md) - 設定ファイルの書き方全般
- [実践ガイド セクション5](PRACTICAL_GUIDE.md#5-claude-skillsによる実践的活用) - Claude Skills の概要
- [Claude Code セットアップ](../docs-template/SETUP_CLAUDE_CODE.md) - CLAUDE.md テンプレートと初期設定
- [Issue #297](https://github.com/feel-flow/ai-spec-driven-development/issues/297) - スキル設計ガイド + オーケストレーション例
