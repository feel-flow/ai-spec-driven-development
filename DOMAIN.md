# ドメインモデル設計書

## ドメイン概要
### ビジネスドメイン
[このシステムが扱うビジネス領域の説明]

### コアドメイン
[システムの中核となる、最も重要なビジネス価値を提供する領域]

### サブドメイン
| サブドメイン | 種別 | 説明 |
|------------|------|------|
| | コア | |
| | 支援 | |
| | 汎用 | |

## ユビキタス言語
### 用語集
| 用語 | 定義 | 英語表記 | 備考 |
|------|------|---------|------|
| | | | |
| | | | |
| | | | |

### 文脈マップ
```
┌─────────────┐     ┌─────────────┐
│  Context1   │────>│  Context2   │
│             │     │             │
└─────────────┘     └─────────────┘
      ↓                    ↑
┌─────────────┐     ┌─────────────┐
│  Context3   │<────│  Context4   │
│             │     │             │
└─────────────┘     └─────────────┘
```

## エンティティ定義
### エンティティ1: [名称]
**概要**: [エンティティの役割と責務]

**属性**:
| 属性名 | 型 | 必須 | 説明 | 制約 |
|-------|-----|------|------|------|
| id | UUID | ✓ | 一意識別子 | |
| | | | | |
| createdAt | DateTime | ✓ | 作成日時 | |
| updatedAt | DateTime | ✓ | 更新日時 | |

**ビジネスルール**:
1. 
2. 
3. 

**振る舞い**:
```typescript
interface Entity1 {
  // メソッドシグネチャ
  method1(): void;
  method2(param: Type): ReturnType;
}
```

### エンティティ2: [名称]
**概要**: 

**属性**:
| 属性名 | 型 | 必須 | 説明 | 制約 |
|-------|-----|------|------|------|
| | | | | |

## 値オブジェクト
### 値オブジェクト1: [名称]
**概要**: [不変で同一性を持たないオブジェクト]

**属性**:
| 属性名 | 型 | 説明 | 制約 |
|-------|-----|------|------|
| | | | |

**実装例**:
```typescript
class ValueObject1 {
  constructor(
    private readonly property1: Type1,
    private readonly property2: Type2
  ) {
    // バリデーション
  }
  
  // メソッド
}
```

## 集約（Aggregate）
### 集約1: [名称]
**集約ルート**: [エンティティ名]

**構成要素**:
- エンティティ: 
- 値オブジェクト: 

**境界ルール**:
1. 外部からは集約ルートを通じてのみアクセス
2. トランザクション境界は集約単位
3. 集約間は最終的整合性

**不変条件**:
- 
- 

## ドメインサービス
### サービス1: [名称]
**責務**: [複数のエンティティにまたがるビジネスロジック]

**インターフェース**:
```typescript
interface DomainService1 {
  method1(param1: Type1, param2: Type2): Result;
}
```

**実装上の注意**:
- ステートレスに保つ
- ビジネスロジックのみ（技術的関心事は含まない）

## ドメインイベント
### イベント1: [名称]
**発生契機**: [いつ発生するか]

**ペイロード**:
| 属性名 | 型 | 説明 |
|-------|-----|------|
| eventId | UUID | イベントID |
| occurredAt | DateTime | 発生日時 |
| | | |

**サブスクライバー**:
- 
- 

## リポジトリインターフェース
### リポジトリ1: [エンティティ名]Repository
```typescript
interface Entity1Repository {
  findById(id: UUID): Promise<Entity1 | null>;
  findBy(criteria: Criteria): Promise<Entity1[]>;
  save(entity: Entity1): Promise<void>;
  delete(id: UUID): Promise<void>;
}
```

**実装上の注意**:
- ドメイン層にインターフェースを定義
- 実装はインフラストラクチャ層
- 集約単位で永続化

## ビジネスルール詳細
### ルール1: [名称]
**条件**: 
**アクション**: 
**例外**: 

### ルール2: [名称]
**条件**: 
**アクション**: 
**例外**: 

## 状態遷移
### [エンティティ名]の状態遷移
```
[初期状態] --イベント1--> [状態A]
[状態A] --イベント2--> [状態B]
[状態B] --イベント3--> [最終状態]
```

**状態定義**:
| 状態 | 説明 | 可能なアクション |
|------|------|---------------|
| | | |
| | | |

## バリデーションルール
### エンティティレベル
| エンティティ | 属性 | ルール | エラーメッセージ |
|------------|------|--------|--------------|
| | | | |

### ビジネスルールレベル
| ルール名 | 条件 | エラーメッセージ |
|---------|------|--------------|
| | | |

## ドメインモデル図
```
┌─────────────────┐
│   Aggregate1    │
├─────────────────┤
│ - Entity1       │
│ - ValueObject1  │
│ - ValueObject2  │
└────────┬────────┘
         │
         ├──関連──>
         │
┌────────┴────────┐
│   Aggregate2    │
├─────────────────┤
│ - Entity2       │
│ - Entity3       │
└─────────────────┘
```

## 実装ガイドライン
### エンティティ実装
1. イミュータブルな属性は`readonly`で定義
2. ビジネスロジックはエンティティ内に実装
3. 技術的関心事は含めない

### 値オブジェクト実装
1. 完全にイミュータブル
2. 等価性は値で判断
3. 自己検証（コンストラクタでバリデーション）

### ドメインサービス実装
1. ステートレス
2. 依存性注入を使用
3. インターフェースと実装を分離

## テスト戦略
### ユニットテスト
- エンティティのビジネスロジック
- 値オブジェクトのバリデーション
- ドメインサービスの振る舞い

### 統合テスト
- 集約の不変条件
- ドメインイベントの発行
- リポジトリとの連携

## よくある実装パターン
### ファクトリーパターン
```typescript
class Entity1Factory {
  static create(params: CreateParams): Entity1 {
    // 複雑な生成ロジック
    return new Entity1(...);
  }
}
```

### 仕様パターン
```typescript
interface Specification<T> {
  isSatisfiedBy(candidate: T): boolean;
  and(other: Specification<T>): Specification<T>;
  or(other: Specification<T>): Specification<T>;
  not(): Specification<T>;
}
```