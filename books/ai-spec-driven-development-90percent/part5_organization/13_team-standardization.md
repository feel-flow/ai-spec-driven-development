# 第13章　チーム標準化：レビューの中心を「コード」から「仕様」へ

## この章で学ぶこと

- 仕様レビュー→タスク→実装レビューの順序
- 「MASTERが更新されていないPRは受け付けない」ルール
- チーム全体での運用定着

---

## レビューの順序を変える

### 従来のレビューフロー

```
実装 → コードレビュー → 修正 → マージ
         ↑
    「これ、仕様と違うよね？」
    「そもそもこの仕様でいいの？」
```

コードを書いてからレビューすると、**根本的な指摘が後から出てきます**。

その結果：
- 大幅な手戻り
- モチベーションの低下
- 時間の浪費

### 新しいレビューフロー

```
仕様レビュー → タスク化 → 実装 → 実装レビュー → マージ
     ↑                           ↑
「この仕様でいい？」          「仕様通りに書けてる？」
```

仕様を先にレビューすることで：
- 根本的な問題を早期発見
- 実装レビューは「仕様通りか」に集中
- 手戻りが最小化

---

## 仕様レビューの実践

### 仕様レビューの対象

| 対象 | レビュー観点 |
|------|------------|
| Issue | 受け入れ基準は具体的か、スコープは適切か |
| 文書変更 | 影響度は正しいか、関連文書は更新されているか |
| ADR | 決定理由は妥当か、代替案は検討されているか |

### 仕様レビューのチェックリスト

```markdown
## 仕様レビューチェックリスト

### Issue
- [ ] 受け入れ基準が具体的で検証可能か
- [ ] 技術的制約が明示されているか
- [ ] スコープ外が明確か
- [ ] 関連文書へのリンクがあるか

### 文書変更
- [ ] 影響度（LOW/MEDIUM/HIGH）が正しく評価されているか
- [ ] Frontmatter（version, updated）が更新されているか
- [ ] MASTER.mdの索引が更新されているか
- [ ] 他の文書との矛盾がないか

### ADR
- [ ] 決定の背景が理解できるか
- [ ] 代替案が検討されているか
- [ ] 却下理由が妥当か
- [ ] 将来の参照に十分な情報があるか
```

### 仕様レビューのタイミング

```
Issue作成 → 仕様レビュー → 承認 → 実装開始
                ↑
            このタイミング
```

実装を始める**前**にレビューを完了させます。

---

## 「MASTERが更新されていないPRは受け付けない」ルール

### なぜこのルールが必要か

7文書構成の中心はMASTER.mdです。

MASTER.mdが最新でないと：
- AIが古い情報を参照する
- チームメンバーが情報を見つけられない
- 文書が形骸化する

### ルールの実装

#### GitHub Actionsでの自動チェック

```yaml
# .github/workflows/docs-check.yml
name: Documentation Check

on:
  pull_request:
    paths:
      - 'docs/**'
      - 'src/**'

jobs:
  check-master:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Check MASTER.md updated
        run: |
          # docs/配下が変更されている場合、MASTER.mdも変更されているか確認
          DOCS_CHANGED=$(git diff --name-only origin/${{ github.base_ref }} | grep '^docs/' | wc -l)
          MASTER_CHANGED=$(git diff --name-only origin/${{ github.base_ref }} | grep '^docs/MASTER.md' | wc -l)

          if [ "$DOCS_CHANGED" -gt 0 ] && [ "$MASTER_CHANGED" -eq 0 ]; then
            echo "::error::docs/ was changed but MASTER.md was not updated"
            echo "Please update MASTER.md to reflect the changes"
            exit 1
          fi

      - name: Validate Frontmatter
        run: |
          node scripts/validate-frontmatter.js docs/*.md
```

#### PRテンプレートでの確認

```markdown
<!-- .github/pull_request_template.md -->

## チェックリスト

### コード変更時
- [ ] 関連するテストを追加・更新した
- [ ] 既存のテストがすべてパスする

### 文書変更時
- [ ] MASTER.mdの索引を更新した
- [ ] Frontmatter（version, updated）を更新した
- [ ] 影響度を評価した（LOW/MEDIUM/HIGH）

### すべてのPR
- [ ] 関連するIssueをリンクした
- [ ] レビュワーを適切に設定した
```

---

## チーム全体での運用定着

### 段階的な導入

一度にすべてを導入しようとすると失敗します。段階的に進めましょう。

#### Phase 1：MASTER.mdだけ始める（1週間）

- MASTER.mdを作成
- 「MASTER.mdを見れば、プロジェクトの全体像がわかる」状態を作る
- まずは1人が主導して更新

#### Phase 2：Issueテンプレートを導入（2週間）

- 受け入れ基準・技術的制約・スコープ外のテンプレート
- 新規Issueはテンプレートに従う
- 仕様レビューの習慣化

#### Phase 3：残りの文書を整備（1ヶ月）

- ARCHITECTURE.md、PATTERNS.mdを優先
- 既存の暗黙知を文書化
- レビューで「PATTERNS.md参照」と言えるようにする

#### Phase 4：自動チェックを導入（1ヶ月）

- CI/CDに文書チェックを追加
- pre-commitフックの設定
- 違反時はマージブロック

### 抵抗への対処

#### 「ドキュメント書く時間がない」

**回答**：最初は時間がかかりますが、長期的には時間を節約します。

- 同じ質問に何度も答える時間が減る
- レビューでの根本的な指摘が減る
- 新メンバーのオンボーディングが速くなる

数値で示す：「過去1ヶ月で、仕様確認のやり取りに何時間かかったか」

#### 「形骸化するだけ」

**回答**：だから自動チェックを入れます。

- 更新されていないPRはマージできない
- 形骸化したら即座に検知される
- 「更新しないとマージできない」が習慣になる

#### 「既存プロジェクトには適用できない」

**回答**：一度に全部やる必要はありません。

- まずMASTER.mdだけ
- 新機能から7文書構成を適用
- 既存部分は触るときに少しずつ文書化

---

## 定着の指標

### 定量指標

| 指標 | 目標 | 測定方法 |
|------|------|---------|
| 仕様レビュー実施率 | 100% | Issueのレビューコメント数 |
| MASTER.md更新率 | 100% | docs変更時のMASTER更新率 |
| PRの平均レビュー回数 | 2回以下 | PRの往復回数 |
| 仕様起因の手戻り | 20%減 | 根本的変更を求めるコメント数 |

### 定性指標

- 「あの仕様どこ？」という質問が減る
- 新メンバーが自力でキャッチアップできる
- レビューが「仕様通りか」に集中する

---

## 章末チェックリスト

- [ ] 仕様レビュー→実装→コードレビューの順序を決める
- [ ] Issueテンプレートを作成する
- [ ] PRテンプレートにチェックリストを追加する
- [ ] CI/CDに文書チェックを追加する
- [ ] 段階的導入の計画を立てる

---

## 次章への橋渡し

この章では、チームでの標準化について学びました。

次章では、**ロードマップとナレッジ蓄積**——成長フェーズで追加すべき文書と、属人性を排除した知識の蓄積について解説します。
