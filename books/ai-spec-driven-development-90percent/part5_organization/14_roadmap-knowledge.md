# 第14章　ロードマップとナレッジ蓄積

## この章で学ぶこと

- 成長フェーズで追加する文書
- **ドキュメント増加の管理戦略**（分割・アーカイブ・月次チェック）
- 属人性を排除した知識の蓄積方法
- AIに「食わせられる」形でナレッジを残す

---

## 成長フェーズで増やす文書

### 7文書から始まる拡張

7文書は**最小構成**です。プロジェクトが成長するにつれて、追加の文書が必要になります。

```
初期（7文書）
├── MASTER.md
├── PROJECT.md
├── ARCHITECTURE.md
├── DOMAIN.md
├── PATTERNS.md
├── TESTING.md
└── DEPLOYMENT.md

成長期（+α）
├── GLOSSARY.md       ← 用語集
├── DECISIONS.md      ← 意思決定の履歴（ADR集）
├── ROADMAP.md        ← 今後の計画
└── LESSONS_LEARNED.md ← 振り返りと教訓
```

### GLOSSARY.md：用語集

#### なぜ必要か

- チーム内で用語の認識がズレる
- 新メンバーが専門用語を理解できない
- AIが用語を誤解する

#### 構造

```markdown
# GLOSSARY.md

## ドメイン用語

### アクティブユーザー
status="active"のユーザー。ログイン可能、購入可能。

### サスペンドユーザー
status="suspended"のユーザー。ログイン不可、既存注文は継続処理。

### 有効在庫
物理在庫 - 予約済み数。注文可能な実質在庫数。

## 技術用語

### トークンリフレッシュ
アクセストークンの有効期限切れ時に、リフレッシュトークンを使って
新しいアクセストークンを取得するプロセス。

### 楽観的ロック
更新時にバージョン番号を比較し、競合を検出する方式。
本プロジェクトではORMのバージョンカラムで実装。
```

### DECISIONS.md：意思決定の履歴

#### なぜ必要か

- 「なぜこの技術を選んだか」が失われる
- 同じ議論が繰り返される
- 過去の決定を覆すときに根拠が必要

#### 構造

```markdown
# DECISIONS.md

## 意思決定一覧

| ID | タイトル | 日付 | 状態 |
|----|---------|------|------|
| ADR-001 | [認証方式の選定](#adr-001) | 2024-01-15 | 承認済 |
| ADR-002 | [DB選定](#adr-002) | 2024-01-20 | 承認済 |
| ADR-003 | [キャッシュ戦略](#adr-003) | 2024-02-01 | 承認済 |

---

## ADR-001: 認証方式の選定

### ステータス
承認済み（2024-01-15）

### コンテキスト
...

### 決定
...

### 理由
...

### 代替案
...
```

### ROADMAP.md：今後の計画

#### なぜ必要か

- 全員が同じ方向を向く
- 優先順位の判断基準になる
- AIに「今は何をすべきか」を伝えられる

#### 構造

```markdown
# ROADMAP.md

## 現在のフェーズ
MVP開発（〜2024年3月）

## マイルストーン

### M1: MVP（2024年3月）
- [x] ユーザー認証
- [x] 商品一覧表示
- [ ] カート機能
- [ ] 決済連携

### M2: ベータ（2024年6月）
- [ ] レビュー機能
- [ ] お気に入り
- [ ] 検索最適化

### M3: 正式リリース（2024年9月）
- [ ] 管理画面
- [ ] 分析ダッシュボード
- [ ] パフォーマンス最適化

## 今はやらないこと（Icebox）
- ソーシャルログイン（M2以降で検討）
- 多言語対応（正式リリース後）
- ネイティブアプリ（未定）
```

### LESSONS_LEARNED.md：振り返りと教訓

#### なぜ必要か

- 同じ失敗を繰り返さない
- 成功パターンを再現する
- チームの成長を可視化する

#### 構造

```markdown
# LESSONS_LEARNED.md

## 2024年Q1の教訓

### 障害：決済APIタイムアウト多発（2024-02-15）

#### 何が起きたか
決済APIのタイムアウトが1%→5%に急増。ユーザーから決済できない報告多数。

#### 原因
決済APIのレスポンスタイムが悪化したが、タイムアウト値が短すぎた（3秒）。

#### 対応
タイムアウトを10秒に延長、リトライ機能を追加。

#### 教訓
- 外部APIのタイムアウトは余裕を持った設定に
- 外部依存の監視を強化する
- SLOを明確に定義しておく

#### 反映先
- DEPLOYMENT.md: モニタリング設定に決済API監視を追加
- ARCHITECTURE.md: 外部API呼び出しポリシーに追記
```

---

## ドキュメント増加の管理戦略

### 文書は必然的に増える

7文書から始まっても、開発が進むにつれて文書は増えていきます。

- ADR（技術選定の記録）
- ナレッジ（障害対応、トラブルシューティング）
- 詳細仕様（複雑な機能の設計書）
- 用語集、FAQ

**これは問題ではなく、プロジェクトの成熟を示す健全な状態**です。

問題は「増えること」ではなく、「管理されないまま増えること」です。

### 成長のフェーズ

```text
Phase 1（初期）: 7文書
    ↓ プロジェクト開始〜MVP
Phase 2（成長）: 7文書 + ADR集約 + ナレッジ
    ↓ MVP〜運用開始
Phase 3（成熟）: 階層化（親文書 + 子文書）
    ↓ 運用開始〜
```

### ファイルサイズの制限

AIツールにはコンテキストの制限があります。そのため、**1ファイルあたりの行数を制限**します。

| しきい値 | アクション |
|---------|----------|
| 500行超 | 分割を検討 |
| 800行超 | 分割を推奨 |
| 1200行超 | 分割を必須 |

#### 分割の方法

親文書（索引）と子文書（詳細）に分割します。

```text
DEPLOYMENT.md（222行 - 索引）
├── deployment/
│   ├── git-workflow.md
│   ├── ci-cd.md
│   ├── infrastructure.md
│   └── monitoring.md
```

親文書には**概要と子文書へのリンク**を記載します。

### 分割のトリガー

| 条件 | アクション |
|------|----------|
| 800行超過 | 子文書に分割 |
| ADR 10件超過 | DECISIONS.mdに分離 |
| ナレッジ蓄積 | 08-knowledge/配下に整理 |

### アーカイブ戦略

古くなった文書は**archive/**ディレクトリに移動します。

```text
docs/
├── archive/              ← 古い文書を保管
│   ├── ADR-001-old.md
│   └── legacy-api.md
├── MASTER.md
└── ...
```

#### アーカイブの基準

- 6ヶ月間参照されていない
- 技術的に陳腐化（例：廃止されたライブラリのADR）
- 別文書に統合された

#### アーカイブの手順

1. Frontmatterに`status: archived`を追加
2. archive/ディレクトリに移動
3. MASTER.mdから参照を削除
4. 元の場所にリダイレクト用のメモを残す（任意）

### 月次参照チェック

毎月、文書の参照状態を確認します。

#### チェックリスト

```markdown
## 月次ドキュメント参照チェック（YYYY-MM）

### 1. MASTER.mdからの参照確認
- [ ] 新規文書がMASTER.mdから参照されているか
- [ ] 参照リンクが有効か（リンク切れなし）
- [ ] 削除・統合された文書の参照が残っていないか

### 2. ファイルサイズ確認
- [ ] 800行を超えた文書はないか
- [ ] 超えている場合、分割計画はあるか

### 3. 鮮度確認
- [ ] 6ヶ月以上更新されていない文書はないか
- [ ] 更新されていない文書の内容は現状と合っているか

### 4. 孤立文書の確認
- [ ] どこからも参照されていない文書はないか
```

#### 自動化

リンク切れチェックをCIで自動化できます。

```yaml
# .github/workflows/docs-link-check.yml
name: Docs Link Check

on:
  pull_request:
    paths:
      - 'docs/**'
      - '**/*.md'

jobs:
  link-check:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Link Checker
        uses: lycheeverse/lychee-action@v1
        with:
          args: --verbose --no-progress 'docs/**/*.md'
          fail: true
```

---

## "知見"をAIに食わせられる形で残す

### 属人化の問題

「あの人に聞かないとわからない」——これが属人化です。

属人化した知識は：
- 担当者がいないと進まない
- AIに伝えられない
- 引き継ぎが困難

### 構造化されたナレッジ

AIに「食わせられる」形とは、**構造化されたテキスト**です。

```markdown
## 悪い例（属人化した知識）
「あれ、認証まわりは田中さんに聞いて」

## 良い例（構造化された知識）
### 認証トラブルシューティング

#### 症状：ログインできない
1. JWTトークンの有効期限を確認
   - 期限切れの場合：リフレッシュトークンで再発行
   - リフレッシュトークンも期限切れ：再ログインを促す

2. Redisのセッション情報を確認
   ```bash
   redis-cli get "session:${userId}"
   ```

3. 認証サービスのログを確認
   ```bash
   kubectl logs -l app=auth-service | grep "auth error"
   ```
```

### ナレッジ蓄積のトリガー

以下のタイミングでナレッジを蓄積します。

| トリガー | 蓄積先 | 内容 |
|---------|--------|------|
| レビューで同じ指摘が3回 | PATTERNS.md | コーディングパターン |
| 障害対応後 | LESSONS_LEARNED.md | 教訓と対策 |
| 技術選定時 | DECISIONS.md | 決定理由と代替案 |
| 新メンバーからの質問 | GLOSSARY.md | 用語の説明 |
| 仕様の議論 | DOMAIN.md | ビジネスルール |

### 蓄積のワークフロー

```
問題発生・質問受領
       │
       ▼
「これ、前にも説明したな」
       │
       ▼
適切な文書に追記
       │
       ▼
MASTER.mdの索引更新
       │
       ▼
次回は「〇〇.md参照」で済む
```

---

## ナレッジの保守

### 陳腐化を防ぐ

ナレッジは放っておくと陳腐化します。

#### 定期レビュー

```markdown
## ナレッジ保守スケジュール

### 月次
- LESSONS_LEARNED.md: 新しい教訓の追加
- ROADMAP.md: 進捗更新

### 四半期
- 全文書のFrontmatterを確認
- リンク切れチェック
- 用語集の更新

### 年次
- 全文書の棚卸し
- 古くなったADRの見直し
- 構造の再評価
```

#### 自動化

```yaml
# .github/workflows/docs-review-reminder.yml
name: Docs Review Reminder

on:
  schedule:
    - cron: '0 9 1 * *'  # 毎月1日9時

jobs:
  reminder:
    runs-on: ubuntu-latest
    steps:
      - name: Create Issue
        uses: actions/github-script@v7
        with:
          script: |
            github.rest.issues.create({
              owner: context.repo.owner,
              repo: context.repo.repo,
              title: '月次ドキュメントレビュー',
              body: '## 確認項目\n- [ ] LESSONS_LEARNED.md\n- [ ] ROADMAP.md\n- [ ] リンク切れチェック',
              labels: ['documentation', 'maintenance']
            })
```

---

## 章末チェックリスト

- [ ] 7文書以外に必要な文書を特定する
- [ ] GLOSSARY.md（用語集）を作成する
- [ ] ADRを書く習慣を始める（まずは1件）
- [ ] ナレッジ蓄積のトリガーを決める
- [ ] 定期レビューのスケジュールを設定する
- [ ] **800行を超えた文書があれば分割計画を立てる**
- [ ] **archive/ディレクトリを作成する**
- [ ] **月次参照チェックをカレンダーに登録する**

---

## 次章への橋渡し

この章では、成長に伴う文書拡張とナレッジ蓄積を学びました。

次章は**おわりに**——本書のまとめと、明日から始める最初の一歩を示します。
